# ============================================================
# ğŸ± Snooker Score Board - GNG Boys
# Spec Driven Flutter Project Configuration
# ============================================================

[tools]
flutter = "latest"
dart = "latest"
bun = "latest"

# ===== ğŸš€ Daily Development Flow =====

[tasks.setup]
description = "ğŸš€ Initial project setup"
run = [
    "echo 'ğŸš€ Starting Snooker Score Board setup...'",
    "flutter doctor -v",
    "flutter pub get",
    "dart pub run build_runner build --delete-conflicting-outputs",
    "bun install -g firebase-tools",
    "echo 'âœ… Setup complete!'",
    "echo ''",
    "echo 'ğŸ“Œ Next steps:'",
    "echo '  mise run dev        # Start development server'",
    "echo '  mise run dev-web    # Test web build'",
    "echo '  mise run mcp        # Start MCP server'",
]

[tasks.dev]
description = "ğŸƒ Run Flutter development server"
run = [
    "echo 'ğŸƒ Launching Flutter in debug mode...'",
    "flutter run",
]

[tasks.dev-web]
description = "ğŸŒ Start Flutter web development server"
run = [
    "echo 'ğŸŒ Starting web server (Chrome)...'",
    "flutter run -d web-server --web-port 8080",
]

[tasks.restart-web]
description = "ğŸ”„ Restart Flutter web development server"
run = '''
#!/usr/bin/env bash
set -e
echo 'ğŸ”„ Killing all Flutter processes...'
pkill -f flutter 2>/dev/null || true
echo 'ğŸ”„ Killing all processes on port 8080...'
fuser -k 8080/tcp 2>/dev/null || true
echo 'ğŸ”„ Waiting for processes to fully terminate...'
sleep 2
echo 'ğŸ”„ Restarting web development server...'
flutter run -d web-server --web-port 8080
'''

[tasks.kill-port]
description = "ğŸ’€ Kill processes on port 8080 and Flutter/Dart processes"
run = '''#!/usr/bin/env bash
set -e
echo 'ğŸ’€ Killing all Flutter processes...'
pkill -f flutter 2>/dev/null || true
echo 'ğŸ’€ Killing all Dart processes...'
pkill -f dart 2>/dev/null || true
echo 'ğŸ’€ Killing all processes on port 8080...'
fuser -k 8080/tcp 2>/dev/null || true
echo 'âœ… Processes on port 8080 and Flutter/Dart processes killed'
'''

[tasks.clean-run-web]
description = "ğŸš€ Kill old processes and run web server"
run = '''#!/usr/bin/env bash
set -e
echo 'ğŸ”„ Cleaning old processes...'
mise run kill-port
echo 'â³ Waiting for processes to fully terminate...'
sleep 3
echo 'ğŸŒ Starting web development server...'
flutter run -d web-server --web-port 8080
'''

[tasks.gen]
description = "ğŸ”¨ Run code generation"
run = [
    "echo 'ğŸ”¨ Running build_runner for code generation...'",
    "dart pub run build_runner build --delete-conflicting-outputs",
    "echo 'âœ… Code generation complete'",
]

[tasks.fix]
description = "ğŸ”§ Analyze, format, and fix code"
run = [
    "echo 'ğŸ”§ Checking code quality...'",
    "dart format lib/ test/",
    "flutter analyze",
    "echo 'âœ… Code quality check complete'",
]

[tasks.test]
description = "ğŸ§ª Run tests (with coverage)"
run = [
    "echo 'ğŸ§ª Running tests...'",
    "flutter test --coverage",
    "echo 'ğŸ“Š Coverage report: coverage/lcov.info'",
    "echo 'ğŸ’¡ Tip: run mise run coverage to generate an HTML report'",
]

[tasks.web-perf-test]
description = "ğŸ“ˆ Run Flutter web server performance test"
run = [
    "echo 'ğŸš€ Starting Flutter web server performance test...'",
    "node flutter_web_performance_test.js",
    "echo 'âœ… Web performance test completed'",
]

# ===== ğŸ‘€ Dev Utilities =====

[tasks.watch]
description = "ğŸ‘€ Watch for file changes and auto-generate code"
run = [
    "echo 'ğŸ‘€ Starting build_runner watch mode...'",
    "dart pub run build_runner watch --delete-conflicting-outputs",
]

[tasks.coverage]
description = "ğŸ“Š Generate HTML coverage report"
run = [
    "if [ ! -f coverage/lcov.info ]; then echo 'âš ï¸  Coverage file not found. Run mise run test first.'; exit 1; fi",
    "genhtml coverage/lcov.info -o coverage/html --ignore-errors source",
    "echo 'âœ… Report generated at coverage/html/index.html'",
]

# ===== ğŸ“¦ Build Targets =====

[tasks.build-android]
description = "ğŸ¤– Build Android APK/AAB"
run = [
    "echo 'ğŸ¤– Building Android release...'",
    "flutter pub get",
    "dart pub run build_runner build --delete-conflicting-outputs",
    "flutter build appbundle --release",
    "echo 'âœ… Done: build/app/outputs/bundle/release/app-release.aab'",
]

[tasks.build-ios]
description = "ğŸ Build iOS IPA"
run = [
    "echo 'ğŸ Building iOS release...'",
    "flutter pub get",
    "dart pub run build_runner build --delete-conflicting-outputs",
    "flutter build ipa --release",
    "echo 'âœ… Done: build/ios/ipa/*.ipa'",
]

[tasks.build-web]
description = "ğŸŒ Build web release"
run = [
    "echo 'ğŸŒ Building web version...'",
    "flutter pub get",
    "dart pub run build_runner build --delete-conflicting-outputs",
    "flutter build web --release",
    "echo 'âœ… Web build complete: build/web/'",
]

# ===== ğŸ§¹ Maintenance =====

[tasks.clean]
description = "ğŸ§¹ Clean and rebuild the project"
run = [
    "echo 'ğŸ§¹ Cleaning Flutter project...'",
    "flutter clean",
    "flutter pub get",
    "echo 'âœ… Cleanup complete'",
]

[tasks.upgrade]
description = "â¬†ï¸ Update dependencies to latest versions"
run = [
    "flutter pub upgrade",
    "dart pub run build_runner clean",
    "dart pub run build_runner build --delete-conflicting-outputs",
    "echo 'âœ… Dependencies updated successfully'",
]

# ===== ğŸ”¥ External Integrations =====

[tasks.firebase]
description = "ğŸ”¥ Configure Firebase project"
run = [
    "firebase login",
    "firebase init",
    "echo 'âœ… Firebase setup complete'",
]

# ===== ğŸ§  MCP & AI DevTools =====

[tasks.mcp]
description = "ğŸ§  Start Model Context Protocol DevTools"
run = [
    "echo 'ğŸ§  Starting MCP Chrome DevTools Server...'",
    "mcp-devtools --port 9100",
    "echo 'âœ… MCP Server: http://127.0.0.1:9100'",
]

[tasks.mcp-dart]
description = "ğŸ§  Start Dart Model Context Protocol Server"
run = [
    "echo 'ğŸ§  Starting MCP Dart Server...'",
    "dart mcp-server",
    "echo 'âœ… Dart MCP Server started'",
]

[tasks.mcp-git]
description = "ğŸ§  Start Git Model Context Protocol Server"
run = [
    "echo 'ğŸ§  Starting MCP Git Server...'",
    "uvx mcp-server-git",
    "echo 'âœ… Git MCP Server started'",
]

[tasks.mcp-sqlite]
description = "ğŸ§  Start SQLite Model Context Protocol Server"
run = [
    "echo 'ğŸ§  Starting MCP SQLite Server...'",
    "bunx -y @modelcontextprotocol/server-sqlite",
    "echo 'âœ… SQLite MCP Server started'",
]

[tasks.mcp-sequential]
description = "ğŸ§  Start Sequential Thinking Model Context Protocol Server"
run = [
    "echo 'ğŸ§  Starting MCP Sequential Thinking Server...'",
    "bunx -y @modelcontextprotocol/server-sequential-thinking",
    "echo 'âœ… Sequential Thinking MCP Server started'",
]

[tasks.mcp-all]
description = "ğŸ§  Start All Model Context Protocol Servers"
run = [
    "echo 'ğŸ§  Starting All MCP Servers in Background...'",
    "dart mcp-server &",
    "uvx mcp-server-git &",
    "bunx -y @modelcontextprotocol/server-sqlite &",
    "bunx -y @modelcontextprotocol/server-sequential-thinking &",
    "echo 'âœ… All MCP servers started in background'",
]

[tasks.web-ai]
description = "ğŸ¤– Launch Flutter Web + MCP AI Integration Mode"
run = [
    "mise run dev-web & mise run mcp",
    "echo 'âœ… Both dev-web and mcp servers are running'",
    "echo 'ğŸŒ Web server: http://localhost:8080'",
    "echo 'ğŸ§  MCP server: http://127.0.0.1:9100'",
    "google-chrome-stable http://localhost:8080",
]

# ===== â“ Help =====

[tasks.help]
description = "â“ Show available commands"
run = [
    "echo 'ğŸ› ï¸ Snooker Score Board - Command Reference'",
    "echo '--------------------------------------------------'",
    "echo 'ğŸš€ setup         Initial project setup'",
    "echo 'ğŸƒ dev           Start development server'",
    "echo 'ğŸŒ dev-web       Start web server'",
    "echo 'ğŸ”„ restart-web   Restart web server'",
    "echo 'ğŸ§  mcp           Start MCP DevTools server'",
    "echo 'ğŸ¤– web-ai        Launch Web + AI mode'",
    "echo 'ğŸ“ˆ perf-test     Web server performance test'",
    "echo 'ğŸ”¨ gen           Run code generation'",
    "echo 'ğŸ§ª test          Run tests'",
    "echo 'ğŸ“¦ build-*       Build targets (android / ios / web)'",
    "echo 'ğŸ§¹ clean         Clean project'",
    "echo 'â¬†ï¸ upgrade       Update dependencies'",
    "echo 'ğŸ”¥ firebase      Firebase setup'",
    "echo 'ğŸ‘€ watch         Watch files for changes'",
    "echo 'ğŸ“Š coverage      Generate HTML coverage report'",
]
